---
import defaultPricing from "../../../data/pricing.json"

/**
 * PricingTable — mobile-first, brand-consistent
 * Props:
 *  items?: Array<{
 *    id: string; name: string; description?: string;
 *    priceRange: string; features: string[]; ctaLabel: string;
 *    highlight?: boolean;
 *  }>
 *  title?: string
 *  subtitle?: string
 *  class?: string
 *  showTitle?: boolean   // NEW: allow page to own the section heading
 */

export interface Plan {
  id: string
  name: string
  description?: string
  priceRange: string
  features: string[]
  ctaLabel: string
  highlight?: boolean
}
export interface Props {
  items?: Plan[]
  title?: string
  subtitle?: string
  class?: string
  showTitle?: boolean
}

const {
  items,
  title = "Choose Your Package",
  subtitle = "Transparent, one-time pricing for every career stage.",
  class: className = "",
  showTitle = true
} = Astro.props as Props

const pricing: Plan[] = items ?? (defaultPricing as Plan[])

// Move CSS import into frontmatter to avoid leaking text into DOM
import "./PricingTable.css"
---

<section
  class={`pricing container ${className}`.trim()}
  id="pricing"
  data-section="pricing"
>
  {showTitle && (
    <header class="pricing__head text-center">
      <h2 class="pricing__title h2">{title}</h2>
      <p class="pricing__sub text-muted">{subtitle}</p>
    </header>
  )}

  <!-- Grid now controlled by CSS for 1→2→3 columns and equal-height cards -->
  <div class="pricing__grid">
    {pricing.map((plan) => (
      <article
        class={`pricing__card card ${plan.highlight ? "is-highlight" : ""}`}
        aria-labelledby={`plan-${plan.id}-title`}
      >
        <header class="pricing__cardHead">
          <h3 id={`plan-${plan.id}-title`} class="pricing__planName">{plan.name}</h3>
          {plan.description && <p class="pricing__planDesc text-muted">{plan.description}</p>}
          <p class="pricing__price">
            <span class="sr-only">Price range:</span>{plan.priceRange}
          </p>
        </header>

        <ul class="pricing__features" aria-label={`${plan.name} features`}>
          {plan.features.map((feat) => (
            <li class="pricing__feature">{feat}</li>
          ))}
        </ul>

        <div class="pricing__actions">
          <a
            href={`/contact/?package=${encodeURIComponent(plan.id)}`}
            class="btn btn-primary pricing__cta"
            data-cta={`pricing-${plan.id}-cta`}
            aria-label={`Select ${plan.name} package`}
          >
            <span class="btn__inner"><span class="btn__label">{plan.ctaLabel}</span></span>
          </a>
        </div>
      </article>
    ))}
  </div>
</section>
